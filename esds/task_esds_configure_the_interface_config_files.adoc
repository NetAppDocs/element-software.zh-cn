---
permalink: esds/task_esds_configure_the_interface_config_files.html 
sidebar: sidebar 
keywords: solidfire esds, host network, networking 
summary: 在安装 SolidFire ESDS 之前，请使用提供的示例和提示配置主机网络。 
---
= 配置主机网络
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
在安装 SolidFire ESDS 之前，请使用提供的示例和提示配置主机网络。

下面是一个示例网络配置：

image::../media/esds_network_config_example.png[显示了一个示例网络配置。]

在此示例中，存储节点上的两个接口为 network https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/ch-configure_network_teaming#sec-Understanding_Network_Teaming["已组合"^] 并连接到管理网络以实现冗余。同样，还会将另外两个接口组合在一起并连接到存储网络。


NOTE: 每个接口都有一个名为 ifcfg-<interface-name>X 的配置文件，其中 X 是接口的编号，从零开始或 1 开始，具体取决于所使用的命名约定。配置文件是在首次创建接口时创建的。连接到存储网络的两个物理接口中的每个接口应已存在一个配置文件。连接到管理网络的两个物理接口中的每一个接口也应具有一个配置文件。接口配置文件位于 /etc/sysconfig/network-scripts 目录中。请参见 https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/getting_started_with_networkmanager["接口配置文件"^]。


TIP: 此处提供的示例包含 HPE 服务器的存储和管理接口名称。如果您使用的是 Dell 服务器，则接口名称会有所不同。Dell 服务器的存储接口名称是 em1 和 EM2 。Dell 服务器的管理接口名称为 p3p1 和 p3p2 。

.步骤
. 安装 `NetworkManager-dispater-routing-rules` 软件包，并确保已配置相应的存储库。
. 使用交换机供应商的文档配置网络交换机。有关配置多机箱链路聚合组（ MLAG ）协议和链路聚合控制协议（ LACP ）的具体说明，请参见交换机供应商的文档。
+

NOTE: 建议您通过运行 `no lacp suspend-individual` 来配置 LACP 回退并禁用 LACP 单个端口暂停行为。这样，即使在配置不当的情况下不广播 LACP 数据包，访问点链路也会启动。

. 使用以下示例编辑连接到存储网络的物理接口的两个配置文件。强烈建议在存储网络上设置巨型帧，但这并不是必需的。在以下示例中，存储接口名称是 ens2f0 ，存储团队名称是 team10G ：
+

IMPORTANT: 在此处列出的所有示例配置中，名称和设备使用相同的值。如果您选择使用不同的值，则可以使用不同的值。

+
[listing]
----
# cat /etc/sysconfig/network-scripts/ifcfg-ens2f0
# 10G Team Physical Port to Storage Network
NAME=ens2f0
DEVICE=ens2f0
ONBOOT=yes
TEAM_MASTER=team10G
DEVICETYPE=TeamPort
MTU=9000
----
. 使用以下示例编辑连接到管理网络的接口的两个配置文件。在此示例中，管理接口名称为 eno5 ，管理团队名称为 team1G ：
+
[listing]
----
# cat ifcfg-eno5
# 1G Team Physical Port to Management Network
NAME=eno5
DEVICE=eno5
ONBOOT=yes
TEAM_MASTER=team1G
DEVICETYPE=TeamPort
----
. 使用以下示例为存储团队创建团队接口文件。在此示例中，该组称为 team10G 。它位于运行网络绑定 LACP 运行程序的存储网络上。
+

NOTE: 建议对存储接口使用主动 / 主动配置。此配置需要在交换机上配置额外的主动 / 主动多机箱链路聚合组（ MLAG ）协议和链路聚合控制协议（ LACP ）。此配置需要 https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/sec-Understanding_the_Network_Teaming_Daemon_and_the_Runners["网络绑定 LACP 运行程序"^]。

+
[listing]
----
# cat /etc/sysconfig/network-scripts/ifcfg-team10G
# IPADDR= "SIP"
# GATEWAY= "SIP_GATEWAY"
# Pick one TEAM_CONFIG, activebackup or lacp
# note that lacp require changing switch port to lacp as well

TEAM_CONFIG="{\"runner\": {\"name\": \"lacp\"}, \"link_watch\": {\"name\": \"ethtool\"}}"
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
DEFROUTE=no
IPV4_FAILURE_FATAL=no
IPV6INIT=no
NAME=team10G
DEVICE=team10G
ONBOOT=yes
DEVICETYPE=Team
IPADDR=192.0.2.2
PREFIX=24
GATEWAY=192.0.2.1
NM_CONTROLLED=yes
MTU=9000
----
. 使用以下示例为管理团队创建团队接口文件。在此示例中，该组称为 team1G 。它位于运行网络绑定操作备份运行程序的管理网络上。
+

NOTE: 建议对管理接口使用主动 / 被动配置，但也可以使用主动 / 主动配置。这不需要对叶交换机进行额外配置。此配置使用 https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/sec-Understanding_the_Network_Teaming_Daemon_and_the_Runners["网络绑定操作备份运行程序"]。

+
[listing]
----
# cat /etc/sysconfig/network-scripts/ifcfg-team1G
# IPADDR= "MIP"
# GATEWAY= "MIP_GATEWAY"
# DNS1= "DNS"
# Pick one TEAM_CONFIG, activebackup or lacp
# note that lacp require changing switch port to lacp as well

TEAM_CONFIG="{\"runner\": {\"name\": \"activebackup\"}, \"link_watch\": {\"name\": \"ethtool\"}}"
#TEAM_CONFIG=”{ \”runner\”: {\”name\”: \”lacp\”, \”active\”: true, \”fast_rate\”: true }}”
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=no
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=team1G
DEVICE=team1G
ONBOOT=yes
DEVICETYPE=Team
IPADDR=198.51.100.2
PREFIX=24
GATEWAY=198.51.100.1
DNS1=198.51.100.250
NM_CONTROLLED=yes
----
. 使用以下示例编辑 ` /etc/iproute2/RT_Tables` 文件以启用新的路由表。此文件将映射定义为使用路由表名称而不是索引编号来引用特定表。在以下示例中，可以按索引（ 20 ）或名称（ team10G ）调用名为 team10G 的新存储路由表：
+
[listing]
----
# cat /etc/iproute2/rt_tables
#
# reserved values
#
255local
254main
253default
0unspec

20   team10G
----
. 使用以下示例将路由添加到存储流量的路由表中。此路由表指向存储网络作为默认网关，并且必须用于 iSCSI 流量。在以下示例中，组队接口名称为 team10G 。
+

NOTE: 您应替换 ` $storage_network` ， ` $storage_if_name src` ， ` $SIP 表` ， ` $routing_table_name` ， ` $storage_default_gw dev` ， ` $storage_if_name src` ， ` $SIP 表` 和 ` $routing_table_name` 。

+
[listing]
----
# cat /etc/sysconfig/network-scripts/route-team10G
$storage_network/24 dev $storage_if_name src $SIP table $routing_table_name
default via $storage_default_gw dev $storage_if_name src $SIP table \
$routing_table_name
----
. 如果流量来自 SIP 或 SVIP ，请添加基于策略的路由以使用您创建的新路由表。使用以下示例并替换为您自己的值：
+
[listing]
----
# cat /etc/sysconfig/network-scripts/rule-team10G
from $SIP table
$routing_table_name
----
. 为要应用的所有更改重新启动网络连接。
+
[listing]
----
# systemctl restart network.service
----
. 要检查基于策略的路由规则，请运行 `ip rule show` 命令。
. 要检查路由表，请运行 `ip route show table` 命令。




== 了解更多信息

* https://www.netapp.com/data-storage/solidfire/documentation/["NetApp SolidFire 资源页面"^]
* https://docs.netapp.com/sfe-122/topic/com.netapp.ndc.sfe-vers/GUID-B1944B0E-B335-4E0B-B9F1-E960BF32AE56.html["早期版本的 NetApp SolidFire 和 Element 产品的文档"^]

