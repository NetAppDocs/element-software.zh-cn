---
permalink: esds/reference_esds_use_maintenance_mode.html 
sidebar: sidebar 
keywords: element, solidfire esds, maintenance, maintenance mode 
summary: 如果您需要使某个存储节点脱机以进行维护，例如软件升级或主机修复，则可以通过为该节点启用维护模式来最大限度地减少对该存储集群其余部分的 I/O 影响。 
---
= 在 SolidFire ESDS 集群上使用维护模式
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果您需要使某个存储节点脱机以进行维护，例如软件升级或主机修复，则可以通过为该节点启用维护模式来最大限度地减少对该存储集群其余部分的 I/O 影响。


TIP: 如果要验证节点上维护模式的当前状态，请使用 link:../api/reference_element_api_listactivenodes.html["`ListActiveNodes`"^] API 方法。节点对象包含 `maintenanceMode` 参数，该参数表示节点上维护模式的当前状态。


NOTE: 确保在启用维护模式后立即执行维护。请勿将节点置于任何必要的维护模式。

只有当存储节点运行状况良好（没有阻止的集群故障）且存储集群能够容忍单个节点故障时，才能将此存储节点过渡到维护模式。为运行状况良好且容错的节点启用维护模式后，该节点不会立即过渡；它会一直受到监控，直到满足以下条件为止：

* 此节点上托管的所有卷均已进行故障转移，并且此节点不再作为任何卷的主节点托管。
* 系统会为要进行故障转移的每个卷分配一个临时备用节点。


满足这些条件后，节点将过渡到维护模式。如果在五分钟内未满足这些条件，则节点将不会进入维护模式。

禁用存储节点的维护模式时，系统会一直监控此节点，直到满足以下条件为止：

* 所有数据都会完全复制到节点。
* 已解决所有阻止的集群故障。
* 此节点上托管的卷的所有临时备用节点分配均已取消激活。


满足这些条件后，节点将过渡到维护模式之外。如果在一小时内未满足这些条件，则节点将无法过渡到维护模式之外。



== 使用维护模式时的可能情形

* 如果节点处于维护模式，但尚未重新启动且 / 或尚未进行维护，或者已进行维护且已备份且运行状况良好，但您尚未禁用维护模式， 另一个节点关闭后，第一个节点上的维护模式将自动禁用。
* 如果其中一个节点处于维护模式，而另一个节点同时关闭，则会发生中断。您必须等待处于维护模式的节点恢复联机。
* 如果您将某个属于某个集合的节点长时间置于维护模式，则系统会自动将其从该集合中删除，前提是可以添加其他节点。




== 启用维护模式

您可以使用 `EnableMaintenanceMode` API 方法启用维护模式。此方法具有以下输入参数：

[cols="5*"]
|===
| Name | Description | Type | 默认值 | Required 


 a| 
`forceWithUnresolvedFaults`
 a| 
强制为此节点启用维护模式，即使存在阻止集群故障也是如此。
 a| 
boolean
 a| 
false
 a| 
否



 a| 
`节点`
 a| 
要置于维护模式的节点 ID 列表。一次仅支持一个节点。
 a| 
整型数组
 a| 
无
 a| 
是的。



 a| 
`perMinutePrimarySwapLimit`
 a| 
每分钟要交换的主分区数。如果未指定，则会一次性交换所有主分区。
 a| 
整型
 a| 
无
 a| 
否



 a| 
`超时`
 a| 
指定维护模式在自动禁用之前应保持启用多长时间。格式化为时间字符串（例如 HH ： mm ： ss ）。如果未指定，维护模式将保持启用状态，直到显式禁用为止。
 a| 
string
 a| 
无
 a| 
否

|===
此方法具有以下返回值：

[cols="3*"]
|===
| Name | Description | Type 


 a| 
`asyncHandle`
 a| 
您可以使用 `GetAsyncResult` 方法检索此 asyncHandle 并确定维护模式过渡完成的时间。
 a| 
整型



 a| 
`当前模式`
 a| 
节点的当前维护模式状态。可能值：

* Disabled ：尚未请求任何维护。
* FailedToRecover ：节点无法从维护模式恢复。
* RecoveringFromMaintenance ：节点正在从维护模式恢复。
* PreparingForMaintenance ：正在执行操作以准备节点以执行维护。
* ReadyForMaintenance ：节点已准备好执行维护。

 a| 
维护模式（字符串）



 a| 
`re队列模式`
 a| 
节点请求的维护模式状态。可能值：

* Disabled ：尚未请求任何维护。
* FailedToRecover ：节点无法从维护模式恢复。
* RecoveringFromMaintenance ：节点正在从维护模式恢复。
* PreparingForMaintenance ：正在执行操作以准备节点以执行维护。
* ReadyForMaintenance ：节点已准备好执行维护。

 a| 
维护模式（字符串）

|===


== 禁用维护模式

您可以使用 `DisableMaintenanceMode` API 方法禁用维护模式。此方法具有以下输入参数：

[cols="5*"]
|===
| Name | Description | Type | 默认值 | Required 


 a| 
`节点`
 a| 
要退出维护模式的存储节点 ID 列表。
 a| 
整型数组
 a| 
无
 a| 
是的。

|===
此方法具有以下返回值：

[cols="3*"]
|===
| Name | Description | Type 


 a| 
`asyncHandle`
 a| 
您可以使用 `GetAsyncResult` 方法检索此 asyncHandle 并确定维护模式过渡完成的时间。
 a| 
整型



 a| 
`当前模式`
 a| 
节点的当前维护模式状态。可能值：

* Disabled ：尚未请求任何维护。
* FailedToRecover ：节点无法从维护模式恢复。
* Unexpected ：发现节点脱机，但处于 Disabled 模式。
* RecoveringFromMaintenance ：节点正在从维护模式恢复。
* PreparingForMaintenance ：正在执行操作以准备节点以执行维护。
* ReadyForMaintenance ：节点已准备好执行维护。

 a| 
维护模式（字符串）



 a| 
`re队列模式`
 a| 
节点请求的维护模式状态。可能值：

* Disabled ：尚未请求任何维护。
* FailedToRecover ：节点无法从维护模式恢复。
* Unexpected ：发现节点脱机，但处于 Disabled 模式。
* RecoveringFromMaintenance ：节点正在从维护模式恢复。
* PreparingForMaintenance ：正在执行操作以准备节点以执行维护。
* ReadyForMaintenance ：节点已准备好执行维护。

 a| 
维护模式（字符串）

|===


== 了解更多信息

* https://www.netapp.com/data-storage/solidfire/documentation/["NetApp SolidFire 资源页面"^]
* https://docs.netapp.com/sfe-122/topic/com.netapp.ndc.sfe-vers/GUID-B1944B0E-B335-4E0B-B9F1-E960BF32AE56.html["早期版本的 NetApp SolidFire 和 Element 产品的文档"^]

